[include macros.cfg]
[include mainsail.cfg]
[include moonraker_obico_macros.cfg]
[include leds.cfg]
[include steppers.cfg]
[include eddy.cfg]
#[include adxl.cfg]

[mcu CB2]
serial: /tmp/klipper_host_mcu

[mcu]
canbus_uuid: 180ac67ddbf9

[mcu ebb36]
canbus_uuid: 58d36d4c9c89

[exclude_object]

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC15
detection_length: 5.88 # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
  #SET_IDLE_TIMEOUT TIMEOUT=7200
  #PAUSE X=0 Y=0
  M117 Filament encoder runout
  RESPOND TYPE=error MSG='Filament encoder runout'
insert_gcode:
  M117 Filament encoder inserted

[filament_switch_sensor switch_sensor]
switch_pin: ^PF0
pause_on_runout: False
runout_gcode:
  SET_IDLE_TIMEOUT TIMEOUT=7200
  PAUSE X=0 Y=0
  M117 Filament switch runout
  RESPOND TYPE=error MSG='Filament switch runout'
#insert_gcode:
  M117 Filament switch inserted
  
[pause_resume]

[fan_generic CB2]
pin: PA6
tachometer_pin: PC2

[fan_generic driver1]
pin: PF9

[fan_generic driver2]
pin: PF6

[fan_generic driver3]
pin: PF8

[delayed_gcode start_fan_at_startup]
initial_duration: 1.
gcode:
  SET_FAN_SPEED FAN=CB2 SPEED=1.0
  STATUS_READY

[printer]
kinematics: none
max_velocity: 1
max_accel: 1

[led lampje]
white_pin: PF8
cycle_time: 0.001
initial_WHITE: 0.1

[temperature_sensor CB2]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[force_move]
enable_force_move: true

[exclude_object]

[gcode_arcs]

[respond]

[extruder]
step_pin: ebb36: PD0
dir_pin: !ebb36: PD1
enable_pin: !ebb36: PD2
microsteps: 16
rotation_distance: 22.67895 #for 5mm Shaft Driven Bondtech gearsets
gear_ratio: 5:1 #Sherpa Mini uses 5:1, Folded Ascender Use 40:1 or 20:1
full_steps_per_rotation: 200 #1.8 deg motor
nozzle_diameter: 0.4
filament_diameter: 1.75
heater_pin: ebb36: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: ebb36: PA3
#control: pid
#pid_Kp: 32.967
#pid_Ki: 15.699
#pid_Kd: 17.308
min_temp: 0
max_temp: 300
min_extrude_temp: 0
max_extrude_only_distance: 101

[tmc2209 extruder]
uart_pin: ebb36: PA15
run_current: 0.5
stealthchop_threshold: 0

[fan]
pin: ebb36: PA1

[heater_fan hotend_fan]
pin: ebb36: PA0
heater: extruder
heater_temp: 40.0

[led lampje]
white_pin: PF7
cycle_time: 0.001
initial_WHITE: 0.1

[printer]
kinematics: cartesian
max_velocity: 300
max_accel:  3000
max_z_velocity: 5
max_z_accel: 100

[heater_bed]
heater_pin: PF5
sensor_pin: PB1
sensor_type: Generic 3950
#control: watermark
min_temp: 0
max_temp: 130

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3284248.338,0.090000:3284070.188,0.130000:3283151.599,
#*# 	0.170000:3281905.303,0.210000:3280613.844,0.250000:3279368.541,
#*# 	0.290000:3278189.948,0.330000:3276999.831,0.370000:3275779.965,
#*# 	0.410000:3274621.754,0.450000:3273470.299,0.490000:3272360.083,
#*# 	0.530000:3271235.682,0.570000:3270161.794,0.610000:3269122.143,
#*# 	0.650000:3268129.562,0.690000:3267128.957,0.730000:3266111.286,
#*# 	0.770000:3265175.702,0.810000:3264233.197,0.850000:3263358.223,
#*# 	0.890000:3262483.185,0.930000:3261626.432,0.970000:3260808.804,
#*# 	1.010000:3259993.840,1.050000:3259166.064,1.090000:3258385.342,
#*# 	1.130000:3257691.681,1.170000:3256970.635,1.210000:3256234.762,
#*# 	1.250000:3255500.742,1.290000:3254813.712,1.330000:3254147.278,
#*# 	1.370000:3253491.934,1.410000:3252845.471,1.450000:3252207.869,
#*# 	1.490000:3251623.396,1.530000:3251048.116,1.570000:3250461.105,
#*# 	1.610000:3249902.718,1.650000:3249353.959,1.690000:3248841.682,
#*# 	1.730000:3248346.845,1.770000:3247799.195,1.810000:3247296.816,
#*# 	1.850000:3246812.498,1.890000:3246339.720,1.930000:3245904.742,
#*# 	1.970000:3245414.722,2.010000:3244934.392,2.050000:3244501.764,
#*# 	2.090000:3244019.037,2.130000:3243568.519,2.170000:3243143.238,
#*# 	2.210000:3242711.806,2.250000:3242295.670,2.290000:3241847.092,
#*# 	2.330000:3241462.117,2.370000:3241057.767,2.410000:3240633.439,
#*# 	2.450000:3240218.233,2.490000:3239861.242,2.530000:3239483.582,
#*# 	2.570000:3239105.860,2.610000:3238758.752,2.650000:3238367.593,
#*# 	2.690000:3238033.764,2.730000:3237716.256,2.770000:3237320.582,
#*# 	2.810000:3236992.062,2.850000:3236662.919,2.890000:3236334.417,
#*# 	2.930000:3236048.579,2.970000:3235734.617,3.010000:3235428.545,
#*# 	3.050000:3235151.372,3.090000:3234852.675,3.130000:3234579.036,
#*# 	3.170000:3234298.891,3.210000:3234021.446,3.250000:3233735.277,
#*# 	3.290000:3233481.530,3.330000:3233231.746,3.370000:3232981.904,
#*# 	3.410000:3232743.003,3.450000:3232488.288,3.490000:3232257.679,
#*# 	3.530000:3232045.781,3.570000:3231810.150,3.610000:3231594.202,
#*# 	3.650000:3231367.282,3.690000:3231146.375,3.730000:3230899.157,
#*# 	3.770000:3230798.798,3.810000:3230514.688,3.850000:3230288.141,
#*# 	3.890000:3230100.020,3.930000:3229895.901,3.970000:3229677.849,
#*# 	4.010000:3229487.196,4.050000:3229285.263
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 33.549
#*# pid_ki = 15.976
#*# pid_kd = 17.613
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.657
#*# pid_ki = 0.902
#*# pid_kd = 1194.133
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 72.2
#*# shaper_type_y = 2hump_ei
#*# shaper_freq_y = 53.4
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.176351, 0.167984, 0.120667, 0.097208, 0.085061, 0.082170, 0.082766, 0.084759, 0.077944, 0.082834, 0.079173, 0.072218, 0.064911, 0.049107, 0.027408, 0.002973, -0.018577, -0.026411, -0.028412, -0.003535
#*# 	  0.124955, 0.114483, 0.104324, 0.095840, 0.102794, 0.110258, 0.107454, 0.114974, 0.115677, 0.121586, 0.107454, 0.121649, 0.105992, 0.090485, 0.063141, 0.054396, 0.037975, 0.018549, 0.028520, 0.019998
#*# 	  0.082835, 0.097368, 0.074213, 0.080773, 0.092548, 0.100268, 0.106456, 0.110472, 0.120669, 0.124401, 0.119536, 0.128963, 0.121450, 0.108821, 0.086893, 0.075650, 0.059685, 0.043880, 0.041370, 0.052358
#*# 	  0.111177, 0.101729, 0.096373, 0.101729, 0.109913, 0.124187, 0.121924, 0.136280, 0.141056, 0.152056, 0.145003, 0.155073, 0.149779, 0.144791, 0.117300, 0.112350, 0.092247, 0.081700, 0.081769, 0.084427
#*# 	  0.125168, 0.132483, 0.113658, 0.122841, 0.135024, 0.139586, 0.150681, 0.163591, 0.161468, 0.163591, 0.163381, 0.169627, 0.167834, 0.160105, 0.139372, 0.131076, 0.119686, 0.101566, 0.100431, 0.097439
#*# 	  0.144299, 0.142464, 0.132965, 0.140779, 0.151367, 0.164756, 0.171002, 0.180535, 0.186839, 0.175604, 0.184598, 0.183702, 0.187826, 0.174288, 0.159407, 0.149076, 0.142891, 0.117788, 0.120392, 0.112433
#*# 	  0.181848, 0.192745, 0.162007, 0.168939, 0.178951, 0.190611, 0.198159, 0.202597, 0.211671, 0.207292, 0.199888, 0.205507, 0.207348, 0.191072, 0.186870, 0.174567, 0.166340, 0.151906, 0.131628, 0.132421
#*# 	  0.204383, 0.213257, 0.199081, 0.199081, 0.207437, 0.213571, 0.223826, 0.232797, 0.231817, 0.223366, 0.224231, 0.223625, 0.223750, 0.223917, 0.215042, 0.210864, 0.199024, 0.163233, 0.155761, 0.155761
#*# 	  0.234909, 0.243471, 0.226219, 0.229533, 0.236917, 0.242307, 0.252457, 0.249180, 0.254518, 0.250447, 0.245954, 0.252282, 0.251055, 0.246140, 0.246376, 0.254754, 0.237104, 0.206004, 0.180265, 0.167775
#*# 	  0.259855, 0.263317, 0.255311, 0.252086, 0.259010, 0.265073, 0.269262, 0.276995, 0.270472, 0.262101, 0.271613, 0.273220, 0.273369, 0.272696, 0.266407, 0.264533, 0.258094, 0.215705, 0.194645, 0.183015
#*# 	  0.278809, 0.278921, 0.273481, 0.276117, 0.286790, 0.291088, 0.295800, 0.299632, 0.297407, 0.296473, 0.295333, 0.298025, 0.306468, 0.306417, 0.292846, 0.279482, 0.249231, 0.222445, 0.204180, 0.209281
#*# 	  0.300809, 0.295388, 0.286789, 0.298492, 0.306211, 0.313545, 0.313995, 0.314394, 0.318693, 0.312695, 0.311594, 0.317048, 0.328551, 0.339058, 0.314792, 0.293519, 0.270322, 0.241225, 0.238742, 0.239267
#*# 	  0.312444, 0.312842, 0.307970, 0.316596, 0.324650, 0.327302, 0.337956, 0.341460, 0.336709, 0.339458, 0.336206, 0.334958, 0.346513, 0.342479, 0.336207, 0.326401, 0.305071, 0.274360, 0.250024, 0.247541
#*# 	  0.315747, 0.322647, 0.321465, 0.323401, 0.340359, 0.345214, 0.353050, 0.350015, 0.355496, 0.351602, 0.357533, 0.358748, 0.360570, 0.358747, 0.352940, 0.359541, 0.342561, 0.303931, 0.286995, 0.270941
#*# 	  0.320800, 0.332703, 0.327901, 0.342812, 0.351277, 0.362811, 0.371171, 0.381585, 0.379531, 0.382083, 0.384669, 0.393893, 0.396190, 0.390176, 0.385882, 0.385883, 0.375467, 0.344112, 0.322699, 0.313930
#*# 	  0.290978, 0.301358, 0.310692, 0.320748, 0.341260, 0.353050, 0.365473, 0.377289, 0.388124, 0.389994, 0.396740, 0.407387, 0.420147, 0.417945, 0.406974, 0.394582, 0.388124, 0.368088, 0.374674, 0.368929
#*# 	  0.261812, 0.271351, 0.283164, 0.307447, 0.334255, 0.344962, 0.367715, 0.378924, 0.392930, 0.404541, 0.420408, 0.426434, 0.437001, 0.439665, 0.441235, 0.431760, 0.425608, 0.415786, 0.414135, 0.426390
#*# 	  0.193723, 0.222187, 0.245295, 0.278248, 0.314142, 0.343012, 0.353471, 0.367342, 0.389898, 0.402981, 0.421203, 0.438686, 0.453592, 0.469831, 0.470945, 0.470943, 0.473840, 0.466165, 0.473124, 0.499365
#*# 	  0.136493, 0.177935, 0.214435, 0.278865, 0.336856, 0.357114, 0.368758, 0.373413, 0.392103, 0.419000, 0.444640, 0.470586, 0.490273, 0.509036, 0.517945, 0.535667, 0.543161, 0.541980, 0.555992, 0.570743
#*# 	  0.082233, 0.138882, 0.210662, 0.280006, 0.354126, 0.389106, 0.392746, 0.401559, 0.419412, 0.451610, 0.475085, 0.509478, 0.545660, 0.569012, 0.584608, 0.602064, 0.615094, 0.631015, 0.657645, 0.690263
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 209.94
#*# min_y = 10.0
#*# max_y = 214.82000000000002
