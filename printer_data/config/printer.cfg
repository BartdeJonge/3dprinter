[include macros.cfg]
[include mainsail.cfg]
[include moonraker_obico_macros.cfg]
[include leds.cfg]
[include steppers.cfg]
[include eddy.cfg]
#[include adxl.cfg]

[mcu CB2]
serial: /tmp/klipper_host_mcu

[mcu]
canbus_uuid: 180ac67ddbf9

[mcu ebb36]
canbus_uuid: 58d36d4c9c89

[exclude_object]

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC15
detection_length: 5.88 # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
  SET_IDLE_TIMEOUT TIMEOUT=7200
  PAUSE X=0 Y=0
  M117 Filament encoder runout
  RESPOND TYPE=error MSG='Filament encoder runout'
insert_gcode:
  M117 Filament encoder inserted

[filament_switch_sensor switch_sensor]
switch_pin: ^PF0
pause_on_runout: False
runout_gcode:
  SET_IDLE_TIMEOUT TIMEOUT=7200
  PAUSE X=0 Y=0
  M117 Filament switch runout
  RESPOND TYPE=error MSG='Filament switch runout'
insert_gcode:
  M117 Filament switch inserted
  
[pause_resume]

[fan_generic CB2]
pin: PA6
tachometer_pin: PC2

[delayed_gcode start_fan_at_startup]
initial_duration: 1.
gcode:
  SET_FAN_SPEED FAN=CB2 SPEED=1.0
  STATUS_READY

[printer]
kinematics: none
max_velocity: 1
max_accel: 1

[led lampje]
white_pin: PF8
cycle_time: 0.001
initial_WHITE: 0.1

[temperature_sensor CB2]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[force_move]
enable_force_move: true

[exclude_object]

[gcode_arcs]

[respond]

[extruder]
step_pin: ebb36: PD0
dir_pin: !ebb36: PD1
enable_pin: !ebb36: PD2
microsteps: 16
rotation_distance: 22.67895 #for 5mm Shaft Driven Bondtech gearsets
gear_ratio: 5:1 #Sherpa Mini uses 5:1, Folded Ascender Use 40:1 or 20:1
full_steps_per_rotation: 200 #1.8 deg motor
nozzle_diameter: 0.4
filament_diameter: 1.75
heater_pin: ebb36: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: ebb36: PA3
#control: pid
#pid_Kp: 32.967
#pid_Ki: 15.699
#pid_Kd: 17.308
min_temp: 0
max_temp: 300
min_extrude_temp: 0
max_extrude_only_distance: 101

[tmc2209 extruder]
uart_pin: ebb36: PA15
run_current: 0.5
stealthchop_threshold: 0

[fan]
pin: ebb36: PA1

[heater_fan hotend_fan]
pin: ebb36: PA0
heater: extruder
heater_temp: 40.0

[led lampje]
white_pin: PF7
cycle_time: 0.001
initial_WHITE: 0.1

[printer]
kinematics: cartesian
max_velocity: 300
max_accel:  3000
max_z_velocity: 5
max_z_accel: 100

[heater_bed]
heater_pin: PF5
sensor_pin: PB1
sensor_type: Generic 3950
#control: watermark
min_temp: 0
max_temp: 130

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [probe_eddy_current btt_eddy]
#*# reg_drive_current = 16
#*# calibrate =
#*# 	0.050000:3284248.338,0.090000:3284070.188,0.130000:3283151.599,
#*# 	0.170000:3281905.303,0.210000:3280613.844,0.250000:3279368.541,
#*# 	0.290000:3278189.948,0.330000:3276999.831,0.370000:3275779.965,
#*# 	0.410000:3274621.754,0.450000:3273470.299,0.490000:3272360.083,
#*# 	0.530000:3271235.682,0.570000:3270161.794,0.610000:3269122.143,
#*# 	0.650000:3268129.562,0.690000:3267128.957,0.730000:3266111.286,
#*# 	0.770000:3265175.702,0.810000:3264233.197,0.850000:3263358.223,
#*# 	0.890000:3262483.185,0.930000:3261626.432,0.970000:3260808.804,
#*# 	1.010000:3259993.840,1.050000:3259166.064,1.090000:3258385.342,
#*# 	1.130000:3257691.681,1.170000:3256970.635,1.210000:3256234.762,
#*# 	1.250000:3255500.742,1.290000:3254813.712,1.330000:3254147.278,
#*# 	1.370000:3253491.934,1.410000:3252845.471,1.450000:3252207.869,
#*# 	1.490000:3251623.396,1.530000:3251048.116,1.570000:3250461.105,
#*# 	1.610000:3249902.718,1.650000:3249353.959,1.690000:3248841.682,
#*# 	1.730000:3248346.845,1.770000:3247799.195,1.810000:3247296.816,
#*# 	1.850000:3246812.498,1.890000:3246339.720,1.930000:3245904.742,
#*# 	1.970000:3245414.722,2.010000:3244934.392,2.050000:3244501.764,
#*# 	2.090000:3244019.037,2.130000:3243568.519,2.170000:3243143.238,
#*# 	2.210000:3242711.806,2.250000:3242295.670,2.290000:3241847.092,
#*# 	2.330000:3241462.117,2.370000:3241057.767,2.410000:3240633.439,
#*# 	2.450000:3240218.233,2.490000:3239861.242,2.530000:3239483.582,
#*# 	2.570000:3239105.860,2.610000:3238758.752,2.650000:3238367.593,
#*# 	2.690000:3238033.764,2.730000:3237716.256,2.770000:3237320.582,
#*# 	2.810000:3236992.062,2.850000:3236662.919,2.890000:3236334.417,
#*# 	2.930000:3236048.579,2.970000:3235734.617,3.010000:3235428.545,
#*# 	3.050000:3235151.372,3.090000:3234852.675,3.130000:3234579.036,
#*# 	3.170000:3234298.891,3.210000:3234021.446,3.250000:3233735.277,
#*# 	3.290000:3233481.530,3.330000:3233231.746,3.370000:3232981.904,
#*# 	3.410000:3232743.003,3.450000:3232488.288,3.490000:3232257.679,
#*# 	3.530000:3232045.781,3.570000:3231810.150,3.610000:3231594.202,
#*# 	3.650000:3231367.282,3.690000:3231146.375,3.730000:3230899.157,
#*# 	3.770000:3230798.798,3.810000:3230514.688,3.850000:3230288.141,
#*# 	3.890000:3230100.020,3.930000:3229895.901,3.970000:3229677.849,
#*# 	4.010000:3229487.196,4.050000:3229285.263
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 33.549
#*# pid_ki = 15.976
#*# pid_kd = 17.613
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.657
#*# pid_ki = 0.902
#*# pid_kd = 1194.133
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 72.2
#*# shaper_type_y = 2hump_ei
#*# shaper_freq_y = 53.4
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  0.371405, 0.365005, 0.304865, 0.257980, 0.235331, 0.215615, 0.217760, 0.189738, 0.174230, 0.181581, 0.151100, 0.138330, 0.107755, 0.079637, 0.039065, 0.004777, -0.036638, -0.058686, -0.061924, -0.035942
#*# 	  0.296267, 0.288602, 0.270267, 0.250211, 0.244131, 0.228723, 0.225298, 0.214234, 0.208675, 0.211919, 0.193667, 0.185973, 0.173959, 0.145217, 0.114269, 0.086660, 0.058532, 0.032891, 0.032276, 0.009416
#*# 	  0.240618, 0.251427, 0.223366, 0.221714, 0.211324, 0.212190, 0.210718, 0.197496, 0.194443, 0.194644, 0.188932, 0.179578, 0.161529, 0.143810, 0.119196, 0.086058, 0.072079, 0.042522, 0.035938, 0.038182
#*# 	  0.234301, 0.233641, 0.224174, 0.209134, 0.205708, 0.204901, 0.203893, 0.197150, 0.193464, 0.186242, 0.182327, 0.177516, 0.167505, 0.149566, 0.123484, 0.090021, 0.070155, 0.056433, 0.053717, 0.024911
#*# 	  0.237206, 0.242915, 0.230415, 0.223108, 0.220862, 0.215099, 0.223310, 0.214897, 0.212245, 0.213570, 0.199025, 0.205659, 0.184181, 0.168730, 0.141698, 0.125657, 0.105992, 0.084829, 0.071453, 0.070690
#*# 	  0.255919, 0.256950, 0.241276, 0.226421, 0.224894, 0.216423, 0.221579, 0.220917, 0.213312, 0.209741, 0.203979, 0.199484, 0.193118, 0.175125, 0.157614, 0.126790, 0.117853, 0.099666, 0.075881, 0.071221
#*# 	  0.261864, 0.268552, 0.242678, 0.230416, 0.236362, 0.225557, 0.233220, 0.227140, 0.222445, 0.222187, 0.212044, 0.211987, 0.192196, 0.178143, 0.168711, 0.145770, 0.132483, 0.097671, 0.075811, 0.084210
#*# 	  0.283837, 0.281542, 0.262709, 0.246326, 0.244131, 0.233828, 0.242255, 0.235331, 0.230839, 0.223771, 0.220198, 0.213919, 0.205764, 0.195307, 0.183432, 0.173751, 0.157346, 0.123698, 0.098893, 0.088121
#*# 	  0.293630, 0.294454, 0.270473, 0.261020, 0.253352, 0.247964, 0.260885, 0.252693, 0.241834, 0.242204, 0.231920, 0.233569, 0.215098, 0.220512, 0.201991, 0.202192, 0.180265, 0.140137, 0.097371, 0.085129
#*# 	  0.302324, 0.300978, 0.280156, 0.267387, 0.264015, 0.257557, 0.256763, 0.255361, 0.249129, 0.249467, 0.237764, 0.229329, 0.227083, 0.225556, 0.209943, 0.203865, 0.187675, 0.143383, 0.112158, 0.096976
#*# 	  0.308230, 0.306884, 0.288602, 0.286528, 0.272080, 0.272548, 0.275912, 0.267151, 0.256813, 0.260649, 0.248995, 0.247119, 0.242678, 0.249180, 0.221175, 0.199743, 0.178143, 0.136769, 0.111729, 0.113003
#*# 	  0.302530, 0.302379, 0.287407, 0.276379, 0.276116, 0.267759, 0.271351, 0.265140, 0.262287, 0.258403, 0.259010, 0.246141, 0.252694, 0.249416, 0.235753, 0.212245, 0.187197, 0.156658, 0.134022, 0.125168
#*# 	  0.305950, 0.305538, 0.291294, 0.288959, 0.283108, 0.280884, 0.291913, 0.286528, 0.275967, 0.280417, 0.265191, 0.270268, 0.260225, 0.263266, 0.238371, 0.233744, 0.206631, 0.174020, 0.144790, 0.145984
#*# 	  0.290827, 0.293725, 0.285856, 0.274977, 0.281351, 0.275650, 0.281034, 0.282230, 0.276585, 0.268451, 0.270679, 0.277257, 0.277051, 0.262894, 0.262523, 0.258453, 0.245954, 0.198879, 0.179847, 0.166399
#*# 	  0.265748, 0.270062, 0.254535, 0.267810, 0.264111, 0.274567, 0.277725, 0.282490, 0.282440, 0.292902, 0.285183, 0.289687, 0.288135, 0.282285, 0.274360, 0.263874, 0.252880, 0.222849, 0.200608, 0.195509
#*# 	  0.224635, 0.239806, 0.237948, 0.239401, 0.251427, 0.255970, 0.261256, 0.266514, 0.273632, 0.276995, 0.293108, 0.298286, 0.302585, 0.302791, 0.295127, 0.274827, 0.269260, 0.245160, 0.238748, 0.231767
#*# 	  0.172933, 0.192455, 0.195912, 0.207292, 0.224175, 0.239313, 0.256105, 0.262287, 0.272754, 0.294454, 0.295594, 0.312125, 0.308491, 0.321147, 0.310440, 0.306884, 0.296473, 0.280622, 0.280472, 0.289948
#*# 	  0.102261, 0.127771, 0.143168, 0.170643, 0.197977, 0.214436, 0.230787, 0.238741, 0.256950, 0.274155, 0.296473, 0.316742, 0.325100, 0.339907, 0.341962, 0.343277, 0.336509, 0.326600, 0.342110, 0.357114
#*# 	  0.019934, 0.066537, 0.097562, 0.142189, 0.189947, 0.216884, 0.225354, 0.238557, 0.255593, 0.281818, 0.306417, 0.334706, 0.354450, 0.371591, 0.381447, 0.387283, 0.402248, 0.403717, 0.406379, 0.424599
#*# 	  -0.065917, -0.007480, 0.047481, 0.112798, 0.182746, 0.211324, 0.222299, 0.233006, 0.247964, 0.280265, 0.322499, 0.352443, 0.387144, 0.403348, 0.427996, 0.440625, 0.455729, 0.473305, 0.494288, 0.527248
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 209.94
#*# min_y = 10.0
#*# max_y = 214.82000000000002
