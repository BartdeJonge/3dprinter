[include macros.cfg]
[include mainsail.cfg]
[include moonraker_obico_macros.cfg]
[include leds.cfg]
[include steppers.cfg]
#[include eddy.cfg]
#[include adxl.cfg]
[include 3dtouch.cfg]

[mcu CB2]
serial: /tmp/klipper_host_mcu

[mcu]
canbus_uuid: 180ac67ddbf9

[mcu ebb36]
canbus_uuid: 58d36d4c9c89

[exclude_object]

[filament_motion_sensor encoder_sensor]
switch_pin: ^PC15
detection_length: 3.88 # accuracy of motion sensor 2.88mm
extruder: extruder
pause_on_runout: False
runout_gcode:
  SET_IDLE_TIMEOUT TIMEOUT=7200
  PAUSE X=0 Y=0
  M117 Filament encoder runout
  RESPOND TYPE=error MSG='Filament encoder runout'
insert_gcode:
  M117 Filament encoder inserted

[filament_switch_sensor switch_sensor]
switch_pin: ^PF0
pause_on_runout: False
runout_gcode:
  SET_IDLE_TIMEOUT TIMEOUT=7200
  PAUSE X=0 Y=0
  M117 Filament switch runout
  RESPOND TYPE=error MSG='Filament switch runout'
insert_gcode:
  M117 Filament switch inserted
  
[pause_resume]

[fan_generic CB2]
pin: PA6
tachometer_pin: PC2

[delayed_gcode start_fan_at_startup]
initial_duration: 1.
gcode:
  SET_FAN_SPEED FAN=CB2 SPEED=1.0
  STATUS_READY

[printer]
kinematics: none
max_velocity: 1
max_accel: 1

[led lampje]
white_pin: PF8
cycle_time: 0.001
initial_WHITE: 0.1

[temperature_sensor CB2]
sensor_type: temperature_host
min_temp: 10
max_temp: 100

[temperature_sensor MCU]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[force_move]
enable_force_move: true

[exclude_object]

[gcode_arcs]

[respond]

[extruder]
step_pin: ebb36: PD0
dir_pin: !ebb36: PD1
enable_pin: !ebb36: PD2
microsteps: 16
rotation_distance: 22.67895 #for 5mm Shaft Driven Bondtech gearsets
gear_ratio: 5:1 #Sherpa Mini uses 5:1, Folded Ascender Use 40:1 or 20:1
full_steps_per_rotation: 200 #1.8 deg motor
nozzle_diameter: 0.4
filament_diameter: 1.75
heater_pin: ebb36: PB13
sensor_type: ATC Semitec 104NT-4-R025H42G
sensor_pin: ebb36: PA3
#control: pid
#pid_Kp: 32.967
#pid_Ki: 15.699
#pid_Kd: 17.308
min_temp: 0
max_temp: 300
min_extrude_temp: 0
max_extrude_only_distance: 101

[verify_heater extruder]
max_error: 160

[tmc2209 extruder]
uart_pin: ebb36: PA15
run_current: 0.5
stealthchop_threshold: 0

[fan]
pin: ebb36: PA1

[fan_generic filter1]
pin: PA0

[fan_generic filter2]
pin: PA1

[temperature_sensor environment]
sensor_type: Generic 3950
sensor_pin: PB0

[heater_fan hotend_fan]
pin: ebb36: PA0
heater: extruder
heater_temp: 40.0

[led lampje]
white_pin: PF7
cycle_time: 0.001
initial_WHITE: 0.1

[printer]
kinematics: cartesian
max_velocity: 300
max_accel:  3000
max_z_velocity: 5
max_z_accel: 100

[heater_bed]
heater_pin: PF5
sensor_pin: PB1
sensor_type: Generic 3950
#control: watermark
min_temp: 0
max_temp: 130

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 55.977
#*# pid_ki = 13.822
#*# pid_kd = 56.675
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 65.657
#*# pid_ki = 0.902
#*# pid_kd = 1194.133
#*#
#*# [input_shaper]
#*# shaper_type_x = 2hump_ei
#*# shaper_freq_x = 72.2
#*# shaper_type_y = 2hump_ei
#*# shaper_freq_y = 53.4
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	0.275967, 0.264397, 0.255784, 0.255548, 0.261679, 0.265952, 0.277986, 0.277462, 0.283891, 0.295388, 0.298492, 0.299426, 0.297407, 0.290621, 0.276117, 0.262895, 0.256628, 0.251427, 0.244266, 0.216570
#*# 	0.265277, 0.236125, 0.233084, 0.239773, 0.245160, 0.256950, 0.261256, 0.276174, 0.273164, 0.274415, 0.281818, 0.286996, 0.286061, 0.273836, 0.267573, 0.259061, 0.254939, 0.239165, 0.245346, 0.222703
#*# 	0.211785, 0.209538, 0.213956, 0.219851, 0.230839, 0.241698, 0.255733, 0.261020, 0.263024, 0.275650, 0.278398, 0.283575, 0.286940, 0.276845, 0.266593, 0.257980, 0.249180, 0.248808, 0.245717, 0.223108
#*# 	0.214177, 0.191994, 0.192341, 0.202191, 0.207550, 0.223108, 0.235381, 0.251044, 0.240802, 0.253488, 0.259855, 0.263452, 0.258216, 0.255682, 0.245533, 0.241226, 0.237763, 0.223109, 0.226881, 0.212908
#*# 	0.200281, 0.197755, 0.199081, 0.208561, 0.225557, 0.231632, 0.245058, 0.247171, 0.250869, 0.262050, 0.265986, 0.269510, 0.275706, 0.274248, 0.262658, 0.254331, 0.247779, 0.247980, 0.237897, 0.217806
#*# 	0.211122, 0.195969, 0.185285, 0.199081, 0.201241, 0.223108, 0.225815, 0.242255, 0.245346, 0.254889, 0.262151, 0.257000, 0.257608, 0.253672, 0.248758, 0.237127, 0.235517, 0.229735, 0.224489, 0.208876
#*# 	0.190813, 0.200608, 0.200552, 0.200002, 0.212650, 0.223107, 0.236125, 0.243842, 0.248808, 0.251849, 0.252642, 0.259145, 0.262101, 0.250869, 0.250683, 0.244131, 0.234063, 0.225556, 0.217289, 0.198475
#*# 	0.209943, 0.195768, 0.194184, 0.195969, 0.203574, 0.214177, 0.223108, 0.243365, 0.235887, 0.236598, 0.235703, 0.240245, 0.238421, 0.244244, 0.238237, 0.234250, 0.234487, 0.209539, 0.198879, 0.185823
#*# 	0.193666, 0.194903, 0.198418, 0.205305, 0.209337, 0.228783, 0.230417, 0.240195, 0.237814, 0.242018, 0.241462, 0.246089, 0.257929, 0.249230, 0.246613, 0.248386, 0.241462, 0.221985, 0.201732, 0.182535
#*# 	0.197092, 0.185555, 0.187408, 0.193666, 0.204777, 0.217492, 0.214896, 0.235146, 0.231261, 0.227286, 0.232425, 0.234487, 0.238422, 0.229330, 0.230602, 0.222040, 0.213571, 0.192196, 0.179519, 0.173542
#*# 	0.174706, 0.184121, 0.186661, 0.190814, 0.205563, 0.215099, 0.223827, 0.223973, 0.232003, 0.229937, 0.230467, 0.238792, 0.238659, 0.241676, 0.230046, 0.210808, 0.196890, 0.176350, 0.169357, 0.152474
#*# 	0.184120, 0.169906, 0.179101, 0.183971, 0.193723, 0.206428, 0.213514, 0.226402, 0.208416, 0.218355, 0.214896, 0.216424, 0.215964, 0.218728, 0.201932, 0.191332, 0.182058, 0.155013, 0.148862, 0.147882
#*# 	0.153969, 0.171898, 0.175663, 0.186300, 0.195913, 0.206004, 0.218469, 0.218266, 0.215155, 0.220659, 0.222703, 0.226017, 0.230838, 0.226219, 0.220254, 0.204641, 0.191995, 0.175603, 0.165175, 0.143658
#*# 	0.142464, 0.149139, 0.153430, 0.162694, 0.179518, 0.193723, 0.195711, 0.207033, 0.207550, 0.208675, 0.211036, 0.213110, 0.209135, 0.212189, 0.204641, 0.188781, 0.181430, 0.158300, 0.161319, 0.153430
#*# 	0.109448, 0.130096, 0.140993, 0.156718, 0.170465, 0.187616, 0.195912, 0.201933, 0.202596, 0.215872, 0.211987, 0.218007, 0.219334, 0.215963, 0.213110, 0.195970, 0.188991, 0.176081, 0.166877, 0.150203
#*# 	0.082534, 0.089188, 0.109517, 0.121862, 0.144361, 0.148096, 0.164965, 0.189310, 0.179578, 0.189947, 0.193723, 0.196632, 0.198620, 0.200358, 0.198879, 0.181908, 0.174916, 0.160362, 0.162754, 0.164069
#*# 	0.020643, 0.048634, 0.071987, 0.094078, 0.124338, 0.132311, 0.150830, 0.155492, 0.171061, 0.178412, 0.191073, 0.194241, 0.204383, 0.205764, 0.201069, 0.194039, 0.186002, 0.175603, 0.181580, 0.170045
#*# 	-0.033332, -0.006789, 0.017229, 0.052833, 0.086591, 0.098437, 0.107454, 0.127556, 0.138392, 0.150204, 0.156440, 0.175604, 0.178890, 0.185555, 0.189738, 0.190151, 0.185494, 0.180206, 0.193868, 0.200204
#*# 	-0.087614, -0.047243, -0.007338, 0.041432, 0.080634, 0.097904, 0.115250, 0.117576, 0.136769, 0.150413, 0.167506, 0.181848, 0.197092, 0.204162, 0.225354, 0.218873, 0.226477, 0.224949, 0.236176, 0.231683
#*# 	-0.149415, -0.108400, -0.059375, -0.003743, 0.023944, 0.064233, 0.073981, 0.095909, 0.105692, 0.124890, 0.145279, 0.158570, 0.176291, 0.193828, 0.209741, 0.209337, 0.086823, 0.216165, 0.239214, 0.254094
#*# x_count = 20
#*# y_count = 20
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 15.0
#*# max_x = 209.94
#*# min_y = 10.0
#*# max_y = 214.82000000000002
